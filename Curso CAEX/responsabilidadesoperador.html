<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Anupro360 · Responsabilidades del Operador CAEX</title>
  <meta name="description" content="Microaprendizaje con mini‑juegos: responsabilidades del operador de camión de extracción (CAEX). Secuencia pre‑operacional, decisiones de seguridad, comunicación por radio, medioambiente y quiz de 10 preguntas." />
  <style>
    :root{
      --amarillo:#FFB81C; /* Amarillo Minero */
      --naranja:#FF5C00;  /* Naranja */
      --gris:#5C6B6B;     /* Gris Acero */
      --verde:#4B6F44;    /* Verde Mineral */
      --azul:#003B5C;     /* Azul Oscuro */
      --blanco:#FFFFFF;   /* Blanco */
    }
    *{box-sizing:border-box}
    body{margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif; background:linear-gradient(180deg,var(--azul) 0%, #072A3D 100%); color:var(--blanco); -webkit-font-smoothing:antialiased}
    header{position:sticky; top:0; z-index:10; backdrop-filter:saturate(140%) blur(8px); background:rgba(0,59,92,.75); border-bottom:1px solid rgba(255,255,255,.08)}
    .wrap{max-width:1080px; margin:0 auto; padding:16px}
    .brand{display:flex; align-items:center; gap:10px}
    /* ✅ FIX LOGO: no deformar, mantener proporciones */
    .brand img{height:42px; width:auto; border-radius:12px; object-fit:contain; display:block}
    h1{font-size:1.2rem; margin:0}
    .chip{font-size:.75rem; background:rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.15); padding:4px 8px; border-radius:999px}

    .hero{border-bottom:1px solid rgba(255,255,255,.08); background: radial-gradient(900px 220px at 50% -40%, rgba(255,184,28,.2), transparent), radial-gradient(800px 280px at 100% 0%, rgba(255,92,0,.15), transparent)}
    .hero h2{margin:.25rem 0 .5rem; font-size:1.4rem}
    .progress{height:10px; width:100%; border-radius:999px; background:rgba(255,255,255,.12); overflow:hidden}
    .progress>i{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--amarillo),var(--naranja)); transition:width .4s ease}

    .grid{display:grid; gap:16px}
    @media(min-width:960px){.grid{grid-template-columns:1.25fr .75fr}}

    .card{background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius:16px; padding:16px; box-shadow:0 8px 24px rgba(0,0,0,.25)}
    .card h3{margin-top:0}

    .btn, .btn-ghost, .btn-sec{cursor:pointer; border:none; border-radius:12px; padding:10px 14px; font-weight:600}
    .btn{background:linear-gradient(180deg,var(--amarillo),#EAA20F); color:#0b1116; box-shadow:0 6px 16px rgba(255,184,28,.35)}
    .btn:active{transform:translateY(1px)}
    .btn-ghost{background:transparent; color:var(--blanco); border:1px solid rgba(255,255,255,.2); text-decoration:none; display:inline-block}
    .btn-sec{background:linear-gradient(180deg,var(--verde),#375636); color:#fff}

    details{background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:10px 12px}
    details>summary{cursor:pointer; font-weight:700}

    .two{display:grid; gap:12px}
    @media(min-width:780px){.two{grid-template-columns:1fr 1fr}}

    input[type="text"], textarea, select{width:100%; padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,.18); background:rgba(0,0,0,.2); color:var(--blanco)}

    .checklist{display:grid; gap:8px}
    .check{display:flex; align-items:center; gap:8px; background:rgba(255,255,255,.04); padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,.12)}

    /* Juegos + quiz */
    .q{padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04); margin-bottom:10px}
    .opt{display:flex; gap:8px; align-items:flex-start; margin:6px 0}
    .q.correct{border-color: rgba(75,111,68,.9); background: rgba(75,111,68,.08)}
    .q.wrong{border-color: rgba(255,92,0,.9); background: rgba(255,92,0,.08)}
    .opt.correct{outline:2px solid #4B6F44; border-radius:8px; padding:4px}
    .opt.wrong{outline:2px solid #FF5C00; border-radius:8px; padding:4px}

    .note{font-size:.85rem; opacity:.85}
    footer{opacity:.75; font-size:.85rem; padding:24px 0}

    /* Contenedores de juego */
    .pill{display:inline-block; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.2); margin:4px; background:rgba(255,255,255,.06)}
    .slots{display:flex; flex-wrap:wrap; gap:8px; padding:8px; border:1px dashed rgba(255,255,255,.25); border-radius:10px}
    .slot{min-width:180px; min-height:40px; padding:6px 8px; border-radius:8px; border:1px solid rgba(255,255,255,.2); background:rgba(0,0,0,.2)}
    .drag{cursor:grab}

    .list{list-style:none; padding:0; margin:0}
    .list li{display:flex; align-items:center; justify-content:space-between; gap:8px; padding:8px; margin:6px 0; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.12); border-radius:10px}
    .list button{border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.08); color:#fff; border-radius:8px; padding:4px 8px}
  </style>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex; align-items:center; justify-content:space-between; gap:12px">
      <div class="brand">
        <img src="imagotipoblanco.webp" alt="Anupro360">
        <h1>Anupro360 · Responsabilidades del Operador CAEX</h1>
      </div>
      <div class="chip" id="badge">Progreso 0%</div>
    </div>
  </header>

  <section class="hero">
    <div class="wrap">
      <h2>Responsabilidades del Operador de Camión de Extracción</h2>
      <p class="note"><strong>Aprendizajes esperados:</strong> Pre‑operacional, conducción segura, comunicación por radio, manejo de eventos/derrames y cierre de turno. <em>(Contenido extraído del video provisto, presentado como mini‑juegos sin imágenes)</em>.</p>
      <div class="progress" aria-label="Progreso del módulo"><i id="bar"></i></div>
    </div>
  </section>

  <main class="wrap grid" id="app" role="main">
    <!-- Columna izquierda: contenido principal -->
    <section class="card">
      <h3>1) Secuencia Pre‑operacional (ordena los pasos)</h3>
      <p class="note">Usa ▲/▼ para ordenar la secuencia correcta antes de operar el CAEX.</p>
      <ol class="list" id="ordenPreop">
        <li data-id="3">Revisar entorno (obstáculos, derrames, señalización) <span><button data-up>▲</button><button data-down>▼</button></span></li>
        <li data-id="1">Checklist de cabina: frenos, dirección, luces/alarma, claxon <span><button data-up>▲</button><button data-down>▼</button></span></li>
        <li data-id="4">Inspección visual de neumáticos y fugas de fluidos <span><button data-up>▲</button><button data-down>▼</button></span></li>
        <li data-id="2">Verificar documentos/permiso y EPP completo <span><button data-up>▲</button><button data-down>▼</button></span></li>
        <li data-id="5">Probar freno de estacionamiento y dirección a baja velocidad <span><button data-up>▲</button><button data-down>▼</button></span></li>
      </ol>
      <div style="display:flex; gap:8px; flex-wrap:wrap">
        <button class="btn-sec" id="checkPreop">Comprobar secuencia</button>
        <button class="btn-ghost" id="resetPreop">Reiniciar</button>
      </div>
      <div id="fbPreop" class="note" style="margin-top:8px"></div>
      <div style="margin-top:10px"><button class="btn" data-complete="preop">Marcado como aprendido ✓</button></div>
    </section>

    <!-- Columna derecha: ficha -->
    <aside class="card">
      <h3>Ficha del micro‑módulo</h3>
      <ul style="margin:0; padding-left:18px; line-height:1.7">
        <li>Duración total: ~12–15 minutos</li>
        <li>Formato: mini‑juegos interactivos + quiz</li>
        <li>Objetivo: ejecutar operación segura y comunicada</li>
      </ul>
      <hr style="border-color:rgba(255,255,255,.12)">
      <button class="btn-ghost" id="resetAll">Reiniciar progreso</button>
    </aside>

    <!-- 2) Empareja protocolo de radio -->
    <section class="card">
      <h3>2) Empareja el protocolo de radio</h3>
      <p class="note">Arrastra cada <em>etiqueta</em> a su <em>definición</em>.</p>
      <div class="two">
        <div class="slots" id="bank">
          <span class="pill drag" draggable="true" data-key="ID">Identificación</span>
          <span class="pill drag" draggable="true" data-key="UBI">Ubicación</span>
          <span class="pill drag" draggable="true" data-key="CON">Condición/Hallazgo</span>
          <span class="pill drag" draggable="true" data-key="ACC">Acción solicitada</span>
          <span class="pill drag" draggable="true" data-key="RDB">Readback/Confirmación</span>
        </div>
        <div class="slots">
          <div class="slot" data-accept="ID">Tu nombre/código de equipo</div>
          <div class="slot" data-accept="UBI">Dónde te encuentras</div>
          <div class="slot" data-accept="CON">Qué ocurre o detectaste</div>
          <div class="slot" data-accept="ACC">Qué necesitas que hagan</div>
          <div class="slot" data-accept="RDB">Repetición para confirmar</div>
        </div>
      </div>
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px">
        <button class="btn-sec" id="checkRadio">Comprobar</button>
        <button class="btn-ghost" id="resetRadio">Reiniciar</button>
      </div>
      <div id="fbRadio" class="note" style="margin-top:8px"></div>
      <div style="margin-top:10px"><button class="btn" data-complete="radio">Marcado como aprendido ✓</button></div>
    </section>

    <!-- 3) Verdadero / Falso de seguridad -->
    <section class="card">
      <h3>3) Seguridad crítica: Verdadero / Falso</h3>
      <div class="q" data-ok="V">
        <div style="font-weight:700">a) La seguridad tiene prioridad sobre la producción.</div>
        <label class="opt"><input type="radio" name="vf1" value="V"> Verdadero</label>
        <label class="opt"><input type="radio" name="vf1" value="F"> Falso</label>
      </div>
      <div class="q" data-ok="V">
        <div style="font-weight:700">b) Si aparece una alarma roja, debo detener en zona segura y reportar.</div>
        <label class="opt"><input type="radio" name="vf2" value="V"> Verdadero</label>
        <label class="opt"><input type="radio" name="vf2" value="F"> Falso</label>
      </div>
      <div class="q" data-ok="F">
        <div style="font-weight:700">c) Puedo asumir prioridad por tamaño del camión en cruces.</div>
        <label class="opt"><input type="radio" name="vf3" value="V"> Verdadero</label>
        <label class="opt"><input type="radio" name="vf3" value="F"> Falso</label>
      </div>
      <div style="display:flex; gap:8px; flex-wrap:wrap">
        <button class="btn-sec" id="checkVF">Comprobar</button>
        <button class="btn-ghost" id="resetVF">Reiniciar</button>
      </div>
      <div id="fbVF" class="note" style="margin-top:8px"></div>
      <div style="margin-top:10px"><button class="btn" data-complete="seguridad">Marcado como aprendido ✓</button></div>
    </section>

    <!-- 4) Decisor de eventos (escenarios) -->
    <section class="card">
      <h3>4) Decisor de eventos</h3>
      <p class="note">Elige la respuesta más segura según el escenario.</p>
      <div class="q" data-ok="b">
        <div style="font-weight:700">Escenario 1: Sientes vibración fuerte y aparece testigo rojo en pendiente.</div>
        <label class="opt"><input type="radio" name="esc1" value="a"> Bajar la velocidad y continuar hasta la meta.</label>
        <label class="opt"><input type="radio" name="esc1" value="b"> Detener en lugar seguro, aplicar paro seguro y reportar.</label>
        <label class="opt"><input type="radio" name="esc1" value="c"> Desactivar la alarma y seguir.</label>
      </div>
      <div class="q" data-ok="c">
        <div style="font-weight:700">Escenario 2: Observas un derrame menor de hidráulico y estás entrenado en kit.</div>
        <label class="opt"><input type="radio" name="esc2" value="a"> Lavar con agua.</label>
        <label class="opt"><input type="radio" name="esc2" value="b"> Cubrir con tierra y seguir.</label>
        <label class="opt"><input type="radio" name="esc2" value="c"> Aislar, contener con kit, informar.</label>
      </div>
      <div class="q" data-ok="a">
        <div style="font-weight:700">Escenario 3: Duda de prioridad en un cruce con señal PARE.</div>
        <label class="opt"><input type="radio" name="esc3" value="a"> Detener y seguir señalización/órdenes del despachador.</label>
        <label class="opt"><input type="radio" name="esc3" value="b"> Pasar por tamaño del CAEX.</label>
        <label class="opt"><input type="radio" name="esc3" value="c"> Tocar bocina y avanzar.</label>
      </div>
      <div style="display:flex; gap:8px; flex-wrap:wrap">
        <button class="btn-sec" id="checkEsc">Comprobar</button>
        <button class="btn-ghost" id="resetEsc">Reiniciar</button>
      </div>
      <div id="fbEsc" class="note" style="margin-top:8px"></div>
      <div style="margin-top:10px"><button class="btn" data-complete="escenarios">Marcado como aprendido ✓</button></div>
    </section>

    <!-- 5) Quiz (10 preguntas) -->
    <section class="card">
      <h3>5) Quiz final (10 preguntas)</h3>
      <div id="quiz"></div>
      <div style="display:flex; gap:8px; flex-wrap:wrap">
        <button class="btn-sec" id="enviar">Enviar respuestas</button>
        <button class="btn-ghost" id="resetQuiz">Reiniciar quiz</button>
      </div>
      <div id="quizFeedback" class="note" aria-live="polite" style="margin-top:8px"></div>
      <div style="margin-top:10px"><button class="btn" data-complete="quiz">Marcar quiz como completado ✓</button></div>
    </section>

    <!-- 6) Reflexión final -->
    <section class="card">
      <h3>6) Reflexión (2 líneas)</h3>
      <textarea id="reflexion" rows="3" placeholder="¿Qué cambio harás en tu operación y comunicación esta semana?"></textarea>
      <div style="display:flex; gap:8px; margin-top:8px">
        <button class="btn-ghost" id="guardarRef">Guardar</button>
        <button class="btn-ghost" id="copiarRef">Copiar para Classroom</button>
      </div>
      <p class="note">Nota: se guarda solo en este dispositivo.</p>
    </section>
  </main>

  <footer class="wrap">
    <div>© <span id="year"></span> Anupro360 · Archivo: <code>responsabilidadesoperador_v4.html</code> · Sin imágenes (solo juegos)</div>
  </footer>

  <script>
    const $ = (s,d=document)=>d.querySelector(s);
    const $$ = (s,d=document)=>Array.from(d.querySelectorAll(s));
    const store = (k,v)=>localStorage.setItem(k, JSON.stringify(v));
    const read  = (k,def=null)=>{ try{return JSON.parse(localStorage.getItem(k)) ?? def}catch(e){return def} };

    const state = read('anupro360_respop_v4', { done:{preop:false,radio:false,seguridad:false,escenarios:false,quiz:false}, reflexion:'' });

    function calcProgress(){ const total=Object.values(state.done).length; const ok=Object.values(state.done).filter(Boolean).length; const pct=Math.round(ok/total*100); $('#bar').style.width=pct+'%'; $('#badge').textContent=`Progreso ${pct}%`; }

    // Reset total
    $('#resetAll')?.addEventListener('click', ()=>{ localStorage.removeItem('anupro360_respop_v4'); location.reload(); });

    // 1) Ordenar pre-op (controles ▲/▼)
    const list = $('#ordenPreop');
    list.addEventListener('click', (e)=>{
      const btn = e.target.closest('button'); if(!btn) return;
      const li = e.target.closest('li');
      if(btn.hasAttribute('data-up') && li.previousElementSibling){ li.parentNode.insertBefore(li, li.previousElementSibling); }
      if(btn.hasAttribute('data-down') && li.nextElementSibling){ li.parentNode.insertBefore(li.nextElementSibling, li); }
    });
    const solPre = ['2','3','4','1','5']; // Orden correcto basado en video: EPP/doc → entorno → neumáticos/fugas → cabina → prueba a baja velocidad
    $('#checkPreop').addEventListener('click', ()=>{
      const ids = Array.from(list.querySelectorAll('li')).map(li=> li.dataset.id);
      const ok = JSON.stringify(ids)===JSON.stringify(solPre);
      $('#fbPreop').textContent = ok ? '✅ Secuencia correcta: EPP/permiso → entorno → neumáticos/fugas → cabina → prueba.' : '❌ Revisa el orden. Pista: primero seguridad/EPP y permisos, luego entorno y condición del equipo antes de moverte.';
    });
    $('#resetPreop').addEventListener('click', ()=>{ location.reload(); });

    // Marcar completado
    $$('button[data-complete]').forEach(b=>{ b.addEventListener('click', e=>{ const key=e.currentTarget.dataset.complete; state.done[key]=true; store('anupro360_respop_v4', state); calcProgress(); e.currentTarget.textContent='Completado ✓'; e.currentTarget.disabled=true; e.currentTarget.classList.add('btn-ghost'); }); });

    // 2) Drag & drop radio
    let dragged=null; $$('.drag').forEach(el=>{
      el.addEventListener('dragstart', ev=>{ dragged=ev.target; ev.dataTransfer.setData('text/plain', ev.target.dataset.key); });
    });
    $$('.slot, #bank').forEach(el=>{
      el.addEventListener('dragover', ev=> ev.preventDefault());
      el.addEventListener('drop', ev=>{
        ev.preventDefault();
        if(ev.currentTarget.id==='bank'){ ev.currentTarget.appendChild(dragged); return; }
        // Solo permitir 1 por slot
        if(ev.currentTarget.querySelector('.pill')){ $('#fbRadio').textContent='Solo una etiqueta por definición.'; return; }
        ev.currentTarget.appendChild(dragged);
      });
    });
    $('#checkRadio').addEventListener('click', ()=>{
      const pairs = Array.from(document.querySelectorAll('.slot')).map(s=>({need:s.dataset.accept, have: s.querySelector('.pill')?.dataset.key||''}));
      const ok = pairs.every(p=> p.need===p.have && p.have!=='');
      $('#fbRadio').textContent = ok? '✅ Protocolo correcto: ID → UBI → CON → ACC → RDB.' : '❌ Revisa las ubicaciones. Pista: primero te identificas y dices dónde estás.';
    });
    $('#resetRadio').addEventListener('click', ()=>{
      const bank = $('#bank'); document.querySelectorAll('.pill').forEach(p=> bank.appendChild(p)); $('#fbRadio').textContent='';
    });

    // 3) V/F
    function checkVF(){
      let okCount=0, total=0; $$('#app .card:nth-of-type(3) .q').forEach(div=>{
        total++; const ok=div.dataset.ok; const sel = div.querySelector('input:checked')?.value; if(!sel){ div.classList.add('wrong'); return; }
        if(sel===ok){ okCount++; div.classList.add('correct'); } else { div.classList.add('wrong'); }
        div.querySelectorAll('input').forEach(i=> i.disabled=true);
      });
      $('#fbVF').textContent = `Resultado: ${okCount}/${total}. ${okCount===total? '✅ Excelente.':'Vuelve a intentarlo con Reiniciar.'}`;
    }
    $('#checkVF').addEventListener('click', checkVF);
    $('#resetVF').addEventListener('click', ()=>{ $$('#app .card:nth-of-type(3) .q').forEach(div=>{ div.classList.remove('correct','wrong'); div.querySelectorAll('input').forEach(i=>{ i.disabled=false; i.checked=false; }); }); $('#fbVF').textContent=''; });

    // 4) Escenarios
    function checkEsc(){
      let okC=0, total=0; $$('#app .card:nth-of-type(4) .q').forEach(div=>{
        total++; const ok=div.dataset.ok; const sel = div.querySelector('input:checked')?.value; if(!sel){ div.classList.add('wrong'); return; }
        if(sel===ok){ okC++; div.classList.add('correct'); } else { div.classList.add('wrong'); }
        div.querySelectorAll('input').forEach(i=> i.disabled=true);
      });
      $('#fbEsc').textContent = `Resultado: ${okC}/${total}. ${okC===total? '✅ Decisiones correctas.':'Revisa las pistas y vuelve a intentar.'}`;
    }
    $('#checkEsc').addEventListener('click', checkEsc);
    $('#resetEsc').addEventListener('click', ()=>{ $$('#app .card:nth-of-type(4) .q').forEach(div=>{ div.classList.remove('correct','wrong'); div.querySelectorAll('input').forEach(i=>{ i.disabled=false; i.checked=false; }); }); $('#fbEsc').textContent=''; });

    // 5) Quiz 10 preguntas (sin imágenes)
    const preguntas=[
      {q:'La prioridad Nº1 del operador es…', opts:['La producción','La seguridad de personas y entorno','La velocidad de ciclo'], ok:1},
      {q:'Antes de mover el CAEX, debes…', opts:['Revisar WhatsApp','Completar pre‑operacional y entorno','Pedir música a cabina'], ok:1},
      {q:'Ante testigo rojo y vibración anormal…', opts:['Continuar a menor velocidad','Detener en zona segura y reportar','Apagar y salir sin avisar'], ok:1},
      {q:'En radio, el orden correcto inicia con…', opts:['Ubicación','Identificación','Acción solicitada'], ok:1},
      {q:'En cruce con PARE…', opts:['Paso por tamaño','Sigo señalización/Despacho','Toco bocina y avanzo'], ok:1},
      {q:'Para proteger neumáticos…', opts:['Evitar frenadas bruscas y sobreciclos','Circular por bordes suaves y piedras','Cargar por sobre la capacidad'], ok:0},
      {q:'Ante derrame menor y entrenamiento…', opts:['Lavar con agua','Aislar, usar kit, informar','Cubrir con tierra y seguir'], ok:1},
      {q:'Cierre de turno incluye…', opts:['Checklist post‑operacional y traspaso','Apagar directo','Lavar por cuenta propia'], ok:0},
      {q:'Gestión de fatiga: ', opts:['Micro‑pausas y notificar somnolencia','No avisar para no molestar','Energéticas y seguir siempre'], ok:0},
      {q:'Quien define trayectos/colas es…', opts:['Cada operador','Despacho/ROC','Mantenimiento'], ok:1},
    ];

    function renderQuiz(){
      const wrap=$('#quiz'); wrap.innerHTML='';
      preguntas.forEach((p,i)=>{
        const div=document.createElement('div'); div.className='q'; div.dataset.index=i; div.dataset.ok=p.ok;
        div.innerHTML=`<div style="font-weight:700">${i+1}. ${p.q}</div>`;
        p.opts.forEach((txt,j)=>{
          const lab=document.createElement('label'); lab.className='opt';
          lab.innerHTML=`<input type="radio" name="q${i}" value="${j}"><span>${txt}</span>`;
          div.appendChild(lab);
        });
        wrap.appendChild(div);
      });
    }

    function lockQuizAndColor(){
      const blocks = $$('#quiz .q');
      let okCount=0, wrongCount=0, unanswered=0;
      blocks.forEach((div)=>{
        const ok = Number(div.dataset.ok);
        const sel = div.querySelector('input[type="radio"]:checked');
        div.querySelectorAll('input').forEach(inp=> inp.disabled=true);
        const correctLabel = div.querySelector(`input[value="${ok}"]`)?.closest('label');
        correctLabel?.classList.add('correct');
        if(!sel){ div.classList.add('wrong'); unanswered++; wrongCount++; return; }
        const chosen = Number(sel.value);
        if(chosen===ok){ div.classList.add('correct'); okCount++; }
        else { div.classList.add('wrong'); sel.closest('label')?.classList.add('wrong'); wrongCount++; }
      });
      const total = preguntas.length; const pct = Math.round(okCount/total*100);
      const msg = `Resultado: ${okCount}/${total} (${pct}%). ✅ Correctas en verde · ❌ Incorrectas en rojo${unanswered?` · ${unanswered} sin responder`:''}.`;
      $('#quizFeedback').textContent = msg + ' Si tu resultado fue bajo, pulsa “Reiniciar quiz” y repasa los mini‑juegos.';
    }

    function resetQuizColors(){
      $$('#quiz .q').forEach(div=>{
        div.classList.remove('correct','wrong');
        div.querySelectorAll('label').forEach(l=> l.classList.remove('correct','wrong'));
        div.querySelectorAll('input').forEach(inp=>{ inp.disabled=false; inp.checked=false; });
      });
      $('#quizFeedback').textContent='';
    }

    $('#enviar').addEventListener('click', ()=>{ lockQuizAndColor(); });
    $('#resetQuiz').addEventListener('click', ()=>{ resetQuizColors(); });

    // Reflexión
    const ref = $('#reflexion'); ref.value = state.reflexion||'';
    $('#guardarRef').addEventListener('click', ()=>{ state.reflexion = ref.value.trim(); store('anupro360_respop_v4', state); alert('Reflexión guardada en este dispositivo.'); });
    $('#copiarRef').addEventListener('click', async()=>{ try{ await navigator.clipboard.writeText((ref.value||'').trim()); alert('Texto copiado. Pégalo en Classroom.'); }catch(e){ alert('No se pudo copiar automáticamente.'); } });

    // Init
    renderQuiz(); calcProgress(); $('#year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
