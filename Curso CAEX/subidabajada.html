<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Anupro360 · Subida y Bajada del Equipo (módulo completo)</title>
  <meta name="description" content="Aplicación web didáctica 100% texto: Subida y bajada del equipo (CAEX). Contenido ampliado paso a paso con ejemplos, 10 juegos con retroalimentación y un quiz de 20 preguntas. Sin imágenes."/>
  <style>
    :root{
      --amarillo:#FFB81C; --naranja:#FF5C00; --gris:#5C6B6B; --verde:#4B6F44; --azul:#003B5C; --blanco:#FFFFFF;
      --ok:#00C853; --bad:#FF1744;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif; background:linear-gradient(180deg,var(--azul) 0%, #072A3D 100%); color:var(--blanco); -webkit-font-smoothing:antialiased}
    p, li{ text-align: justify; }
    header{position:sticky; top:0; z-index:10; backdrop-filter:saturate(140%) blur(8px); background:rgba(0,59,92,.85); border-bottom:1px solid rgba(255,255,255,.12)}
    .wrap{max-width:1120px; margin:0 auto; padding:16px}
    .brand{display:flex; align-items:center; gap:10px}
    h1{font-size:1.02rem; margin:0}
    .chip{font-size:.75rem; background:rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.15); padding:4px 8px; border-radius:999px}
    .hero{border-bottom:1px solid rgba(255,255,255,.08); background: radial-gradient(900px 220px at 50% -40%, rgba(255,184,28,.25), transparent), radial-gradient(800px 280px at 100% 0%, rgba(255,92,0,.15), transparent)}
    .hero h2{margin:.25rem 0 .5rem; font-size:1.25rem}
    .note{font-size:.92rem; opacity:.95}
    .progress{height:10px; width:100%; border-radius:999px; background:rgba(255,255,255,.15); overflow:hidden}
    .progress>i{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--amarillo),var(--naranja)); transition:width .4s ease}
    .grid{display:grid; gap:16px}
    @media(min-width:980px){.grid{grid-template-columns:1.15fr .85fr}}
    .card{background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.15); border-radius:16px; padding:16px; box-shadow:0 8px 24px rgba(0,0,0,.25)}
    .card h3{margin-top:0}
    .btn,.btn-ghost,.btn-sec{cursor:pointer; border:none; border-radius:12px; padding:10px 14px; font-weight:600}
    .btn{background:linear-gradient(180deg,var(--amarillo),#EAA20F); color:#0b1116; box-shadow:0 6px 16px rgba(255,184,28,.35)}
    .btn:active{transform:translateY(1px)}
    .btn-ghost{background:transparent; color:var(--blanco); border:1px solid rgba(255,255,255,.25); text-decoration:none; display:inline-block}
    .btn-sec{background:linear-gradient(180deg,var(--verde),#375636); color:#fff}
    details{background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:10px 12px}
    details>summary{cursor:pointer; font-weight:700}
    .mini{font-size:.95rem; opacity:.95}
    .q{padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.045); margin-bottom:10px}
    .q.correct{border-color: var(--ok); background: rgba(0,200,83,.12)}
    .q.wrong{border-color: var(--bad); background: rgba(255,23,68,.12)}
    .opt{display:flex; gap:8px; align-items:flex-start; margin:6px 0}
    .opt.correct{outline:2px solid var(--ok); border-radius:8px; padding:4px}
    .opt.wrong{outline:2px solid var(--bad); border-radius:8px; padding:4px}
    .sortable{list-style:none; padding:0; margin:0}
    .sortable li{background:rgba(255,255,255,.06); border:1px dashed rgba(255,255,255,.3); padding:10px; border-radius:10px; margin:6px 0; cursor:grab}
    .sortable li.dragging{opacity:.6}
    .zones{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .zone{border:2px dashed rgba(255,255,255,.35); border-radius:12px; padding:8px; min-height:120px}
    .tag{display:inline-block; margin:6px; padding:8px 10px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.25); border-radius:10px; cursor:grab}
    .dragging{opacity:.6}
    .chip2{font-size:.78rem; padding:4px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.25); background:rgba(255,255,255,.08)}
    .timer{font-weight:700; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.25)}
    textarea{width:100%; padding:10px; border-radius:12px; border:1px solid rgba(255,255,255,.25); background:rgba(255,255,255,.06); color:var(--blanco)}
  </style>
</head>
<body>
<header>
  <div class="wrap" style="display:flex; align-items:center; justify-content:space-between; gap:12px">
    <div class="brand"><h1>Anupro360 · Subida y Bajada del Equipo</h1></div>
    <div class="chip" id="badge">Progreso 0%</div>
  </div>
</header>

<section class="hero">
  <div class="wrap">
    <h2>Método seguro de acceso: tres puntos de apoyo + control de riesgos</h2>
    <p class="note"><strong>Objetivo:</strong> aplicar una subida y bajada seguras <em>siempre por accesos diseñados</em>, con EPP, superficies adherentes, pasamanos firmes y conducta segura. Basado en tu texto (0:09–1:45) y ampliado con pasos, ejemplos y práctica. Incluye <strong>10 juegos</strong> con feedback y <strong>quiz de 20</strong>.</p>
    <div class="progress" aria-label="Progreso del módulo"><i id="bar"></i></div>
  </div>
</section>

<main class="wrap grid">
  <section class="card">
    <h3>1) Verificación previa (60 s)</h3>
    <ul>
      <li><strong>Acceso diseñado:</strong> usa solo escaleras/pasarelas del equipo; nunca llantas ni puntos improvisados.</li>
      <li><strong>EPP y vestimenta:</strong> casco, botas antideslizantes, guantes con agarre; evita <em>ropa suelta</em>.</li>
      <li><strong>Superficies de apoyo:</strong> sin <em>barro, aceites, grasas</em>; peldaños firmes; pasamanos en buen estado.</li>
      <li><strong>Concentración total:</strong> no corras, no uses celular; mirada en el siguiente punto de apoyo.</li>
    </ul>
    <details><summary>Ejemplo aplicado</summary><p>Detectas aceite en el 2.º peldaño: <strong>detén</strong> la maniobra, <strong>bloquea</strong> el acceso, <strong>reporta</strong> y <strong>limpia</strong>. Reanuda cuando esté seco.</p></details>
    <button class="btn" data-complete="vprev">Marcar leído ✓</button>
  </section>

  <section class="card">
    <h3>2) Subida segura (paso a paso)</h3>
    <ol>
      <li>Ubícate <strong>de frente</strong> al acceso.</li>
      <li>Comprueba <strong>firmeza</strong> de pasamanos y peldaños.</li>
      <li>Establece <strong>tres puntos</strong> (dos manos y un pie, o dos pies y una mano).</li>
      <li><strong>Un punto a la vez</strong>: mano–pie–mano.</li>
      <li><strong>Un peldaño por vez</strong>; nunca de dos en dos.</li>
      <li>Mantén el <strong>cuerpo cercano</strong> a la estructura; no te inclines hacia afuera.</li>
      <li>Transporta objetos en <strong>mochila corporativa</strong>.</li>
    </ol>
    <details><summary>Tip andragógico</summary><p>Repite en voz baja la secuencia “mano–pie–mano”. Las rutinas rítmicas mejoran la memoria procedural en adultos.</p></details>
    <button class="btn" data-complete="subida">Marcar leído ✓</button>
  </section>

  <section class="card">
    <h3>3) Bajada segura (paso a paso)</h3>
    <ol>
      <li>Baja <strong>de frente al equipo</strong> (no gires la espalda al vacío).</li>
      <li>Mantén <strong>tres puntos</strong> todo el tiempo.</li>
      <li><strong>Un peldaño por vez</strong>; <u>prohibido</u> saltar.</li>
      <li><strong>Verifica el piso</strong> con el pie antes de cargar el peso.</li>
      <li>Si el acceso no es vertical y el ángulo lo permite, <strong>baja de espaldas</strong> usando pasamanos.</li>
    </ol>
    <details><summary>Ejemplo</summary><p>Ves material suelto en el suelo: solicita limpieza o elige un punto firme para apoyar el pie final.</p></details>
    <button class="btn" data-complete="bajada">Marcar leído ✓</button>
  </section>

  <aside class="card">
    <h3>4) Conductas prohibidas y manejo de objetos</h3>
    <ul>
      <li>Prohibido: correr, saltar peldaños, deslizarse por pasamanos, inclinarse hacia afuera, usar ropa suelta.</li>
      <li>Objetos: usa <strong>mochila corporativa</strong>; si el bulto impide el uso de <em>dos manos</em>, replanifica o pide apoyo.</li>
      <li>Comunicación: reporta accesos dañados; no los uses “solo por esta vez”.</li>
    </ul>
    <button class="btn" data-complete="conductas">Marcar leído ✓</button>
  </aside>

  <!-- ===== JUEGOS (10) ===== -->
  <section class="card" id="j1">
    <h3>5) Juego 1 · Ordena la SUBIDA segura</h3>
    <p class="mini">Arrastra y suelta. Verde = correcto; Rojo = fuera de lugar. Se muestran aciertos/errores.</p>
    <ul class="sortable" id="ordSubida"></ul>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn-sec" id="checkSubida">Evaluar</button>
      <button class="btn-ghost" id="mixSubida">Reiniciar</button>
      <span id="fbSubida" class="chip2"></span>
    </div>
  </section>

  <section class="card" id="j2">
    <h3>6) Juego 2 · Ordena la BAJADA segura</h3>
    <ul class="sortable" id="ordBajada"></ul>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn-sec" id="checkBajada">Evaluar</button>
      <button class="btn-ghost" id="mixBajada">Reiniciar</button>
      <span id="fbBajada" class="chip2"></span>
    </div>
  </section>

  <section class="card" id="j3">
    <h3>7) Juego 3 · ¿Correcto o Prohibido?</h3>
    <div class="zones">
      <div><h4>Correcto</h4><div id="ok3" class="zone"></div></div>
      <div><h4>Prohibido</h4><div id="bad3" class="zone"></div></div>
    </div>
    <div id="pool3" style="margin-top:10px"></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn-sec" id="check3">Evaluar</button>
      <button class="btn-ghost" id="reset3">Reiniciar</button>
      <span id="fb3" class="chip2"></span>
    </div>
  </section>

  <section class="card" id="j4">
    <h3>8) Juego 4 · Completa la frase</h3>
    <p id="fillText" style="line-height:1.9"></p>
    <div id="pool4"></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn-sec" id="check4">Evaluar</button>
      <button class="btn-ghost" id="reset4">Reiniciar</button>
      <span id="fb4" class="chip2"></span>
    </div>
  </section>

  <section class="card" id="j5">
    <h3>9) Juego 5 · Relaciona riesgo con su control</h3>
    <div class="zones" style="grid-template-columns:1fr 1fr 1fr">
      <div><h4>Resbalón</h4><div id="z_resbalon" class="zone"></div></div>
      <div><h4>Pérdida de equilibrio</h4><div id="z_equilibrio" class="zone"></div></div>
      <div><h4>Golpe por objeto</h4><div id="z_objeto" class="zone"></div></div>
    </div>
    <div id="pool5" style="margin-top:10px"></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn-sec" id="check5">Evaluar</button>
      <button class="btn-ghost" id="reset5">Reiniciar</button>
      <span id="fb5" class="chip2"></span>
    </div>
  </section>

  <section class="card" id="j6">
    <h3>10) Juego 6 · Selecciona lo que cumple Tres Puntos</h3>
    <div id="multi6"></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn-sec" id="check6">Evaluar</button>
      <button class="btn-ghost" id="reset6">Reiniciar</button>
      <span id="fb6" class="chip2"></span>
    </div>
  </section>

  <section class="card" id="j7">
    <h3>11) Juego 7 · Checklist de acceso seguro</h3>
    <div id="checklist7"></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn-sec" id="check7">Evaluar</button>
      <button class="btn-ghost" id="reset7">Reiniciar</button>
      <span id="fb7" class="chip2"></span>
    </div>
  </section>

  <section class="card" id="j8">
    <h3>12) Juego 8 · Ordena respuesta ante caída</h3>
    <ul class="sortable" id="ordCaida"></ul>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn-sec" id="check8">Evaluar</button>
      <button class="btn-ghost" id="mix8">Reiniciar</button>
      <span id="fb8" class="chip2"></span>
    </div>
  </section>

  <section class="card" id="j9">
    <h3>13) Juego 9 · Marca las buenas prácticas</h3>
    <div id="check9"></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn-sec" id="check9btn">Evaluar</button>
      <button class="btn-ghost" id="reset9">Reiniciar</button>
      <span id="fb9" class="chip2"></span>
    </div>
  </section>

  <section class="card" id="j10">
    <h3>14) Juego 10 · Decisiones en 10 segundos</h3>
    <div class="timer" id="timer">Tiempo: 10</div>
    <div id="timedQ"></div>
    <div id="timedOpts"></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn-sec" id="nextTimed">Siguiente</button>
      <button class="btn-ghost" id="resetTimed">Reiniciar</button>
      <span id="fb10" class="chip2"></span>
    </div>
  </section>

  <section class="card">
    <h3>15) Quiz final (20 preguntas)</h3>
    <div id="quiz"></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn-sec" id="enviar">Enviar respuestas</button>
      <button class="btn-ghost" id="resetQuiz">Reiniciar quiz</button>
    </div>
    <div id="quizFeedback" class="note" aria-live="polite" style="margin-top:8px"></div>
  </section>

  <section class="card">
    <h3>16) Reflexión final</h3>
    <textarea id="reflexion" rows="3" placeholder="¿Qué controles aplicarás desde hoy en tu subida/bajada?"></textarea>
    <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px">
      <button class="btn-ghost" id="guardarRef">Guardar</button>
      <button class="btn-ghost" id="copiarRef">Copiar para Classroom</button>
    </div>
    <p class="note">Se guarda en este dispositivo.</p>
  </section>
</main>

<footer class="wrap"><div>© <span id="year"></span> Anupro360</div></footer>

<script>
  const $=(s,d=document)=>d.querySelector(s);
  const $$=(s,d=document)=>Array.from(d.querySelectorAll(s));
  const store=(k,v)=>localStorage.setItem(k, JSON.stringify(v));
  const read=(k,def=null)=>{ try{return JSON.parse(localStorage.getItem(k)) ?? def}catch(e){return def} };

  const state = read('anupro360_syb', {done:{vprev:false,subida:false,bajada:false,conductas:false}, reflexion:''});
  function calcProgress(){const total=Object.values(state.done).length, ok=Object.values(state.done).filter(Boolean).length, pct=Math.round(ok/total*100); $('#bar').style.width=pct+'%'; $('#badge').textContent=`Progreso ${pct}%`; }
  $$('button[data-complete]').forEach(b=>b.addEventListener('click',e=>{const k=e.currentTarget.dataset.complete; state.done[k]=true; store('anupro360_syb',state); calcProgress(); e.currentTarget.textContent='Completado ✓'; e.currentTarget.disabled=true; e.currentTarget.classList.add('btn-ghost'); }));

  /* Utilidades juegos */
  function getAfterEl(container, y){
    const els=[...container.querySelectorAll('li:not(.dragging)')];
    let closest={offset:Number.NEGATIVE_INFINITY, element:null};
    els.forEach(ch=>{ const box=ch.getBoundingClientRect(); const off=y-(box.top+box.height/2); if(off<0 && off>closest.offset){ closest={offset:off, element:ch}; }});
    return closest.element;
  }
  function renderOrder(ulSel, items, fbSel){
    const ul=$(ulSel); ul.innerHTML='';
    items.slice().sort(()=>Math.random()-0.5).forEach(txt=>{
      const li=document.createElement('li'); li.draggable=true; li.textContent=txt;
      li.addEventListener('dragstart', ()=> li.classList.add('dragging'));
      li.addEventListener('dragend', ()=> li.classList.remove('dragging'));
      ul.appendChild(li);
    });
    ul.addEventListener('dragover', e=>{ e.preventDefault(); const dragging=ul.querySelector('.dragging'); if(!dragging) return; const after=getAfterEl(ul,e.clientY); if(after==null) ul.appendChild(dragging); else ul.insertBefore(dragging, after); });
    if(fbSel) $(fbSel).textContent='';
  }
  function checkOrder(ulSel, correct, fbSel){
    $$(ulSel+' li').forEach(li=> li.style.outline='');
    const curr=$$(ulSel+' li').map(li=>li.textContent.trim());
    let good=0, bad=0;
    curr.forEach((t,i)=>{ const el=$$(ulSel+' li')[i]; if(t===correct[i]){ good++; el.style.outline='2px solid var(--ok)'; el.style.borderRadius='8px'; } else { bad++; el.style.outline='2px solid var(--bad)'; el.style.borderRadius='8px'; }});
    const pct=Math.round(good/correct.length*100);
    const fb=$(fbSel); fb.textContent=(good===correct.length)?'¡Correcto!':`Aciertos: ${good} · Errores: ${bad} (${pct}%).`; fb.style.color=(good===correct.length)?'var(--ok)':'var(--bad)';
  }
  function renderClassify(poolSel, okSel, badSel, data, fbSel){
    const pool=$(poolSel), ok=$(okSel), bad=$(badSel);
    pool.innerHTML=''; ok.innerHTML=''; bad.innerHTML='';
    data.slice().sort(()=>Math.random()-0.5).forEach(it=>{
      const tag=document.createElement('span'); tag.className='tag'; tag.textContent=it.txt; tag.dataset.tipo=it.tipo; tag.draggable=true;
      tag.addEventListener('dragstart', ()=> tag.classList.add('dragging'));
      tag.addEventListener('dragend', ()=> tag.classList.remove('dragging'));
      pool.appendChild(tag);
    });
    [pool,ok,bad].forEach(z=>{
      z.addEventListener('dragover', e=> e.preventDefault());
      z.addEventListener('drop', e=>{ e.preventDefault(); const d=document.querySelector('.dragging'); if(d){ z.appendChild(d); d.classList.remove('dragging'); } });
    });
    if(fbSel) $(fbSel).textContent='';
  }
  function checkClassify(okSel, badSel, data, fbSel){
    let ok=0,total=data.length;
    [...$(okSel).querySelectorAll('.tag')].forEach(t=>{ if(t.dataset.tipo==='OK'){ ok++; t.style.outline='2px solid var(--ok)'; } else { t.style.outline='2px solid var(--bad)'; }});
    [...$(badSel).querySelectorAll('.tag')].forEach(t=>{ if(t.dataset.tipo==='BAD'){ ok++; t.style.outline='2px solid var(--ok)'; } else { t.style.outline='2px solid var(--bad)'; }});
    const fb=$(fbSel); const pct=Math.round(ok/total*100); fb.textContent=`Resultado: ${ok}/${total} (${pct}%).`; fb.style.color=ok===total?'var(--ok)':'var(--bad)';
  }
  function renderFill(textSel,poolSel,targets,fbSel,template){
    $(textSel).innerHTML=template;
    const pool=$(poolSel); pool.innerHTML='';
    targets.slice().sort(()=>Math.random()-0.5).forEach(({word})=>{
      const tag=document.createElement('span'); tag.className='tag'; tag.textContent=word; tag.draggable=true;
      tag.addEventListener('dragstart', ()=> tag.classList.add('dragging'));
      tag.addEventListener('dragend', ()=> tag.classList.remove('dragging'));
      pool.appendChild(tag);
    });
    $$('.dropSlot').forEach(slot=>{
      slot.addEventListener('dragover', e=> e.preventDefault());
      slot.addEventListener('drop', e=>{ e.preventDefault(); const d=document.querySelector('.dragging'); if(!d) return; slot.textContent=d.textContent; slot.dataset.filled=d.textContent; d.remove(); });
    });
    if(fbSel) $(fbSel).textContent='';
  }
  function checkFill(targets,fbSel){
    let ok=0;
    $$('.dropSlot').forEach(slot=>{
      const key=slot.getAttribute('data-slot'); const target=targets.find(t=>t.slot===key)?.word;
      if((slot.dataset.filled||'').trim().toLowerCase()===target.toLowerCase()){ ok++; slot.style.outline='2px solid var(--ok)'; } else { slot.style.outline='2px solid var(--bad)'; }
    });
    const fb=$(fbSel); fb.textContent = ok===targets.length ? '¡Perfecto!' : `Correctas: ${ok}/${targets.length}.`; fb.style.color = ok===targets.length ? 'var(--ok)' : 'var(--bad)';
  }
  function renderRoles(poolSel, zones, data, fbSel){
    const pool=$(poolSel); pool.innerHTML=''; zones.forEach(id=>$('#'+id).innerHTML='');
    data.slice().sort(()=>Math.random()-0.5).forEach(it=>{
      const tag=document.createElement('span'); tag.className='tag'; tag.textContent=it.txt; tag.dataset.zone=it.zone; tag.draggable=true;
      tag.addEventListener('dragstart', ()=> tag.classList.add('dragging'));
      tag.addEventListener('dragend', ()=> tag.classList.remove('dragging'));
      pool.appendChild(tag);
    });
    zones.forEach(id=>{ const z=$('#'+id); z.addEventListener('dragover', e=> e.preventDefault()); z.addEventListener('drop', e=>{ e.preventDefault(); const d=document.querySelector('.dragging'); if(d){ z.appendChild(d); d.classList.remove('dragging'); } }); });
    if(fbSel) $(fbSel).textContent='';
  }
  function checkRoles(zones, data, fbSel){
    let ok=0,total=data.length;
    zones.forEach(id=>{ [...$('#'+id).querySelectorAll('.tag')].forEach(t=>{ if(t.dataset.zone===id){ ok++; t.style.outline='2px solid var(--ok)'; } else { t.style.outline='2px solid var(--bad)'; } }); });
    const pct=Math.round(ok/total*100); const fb=$(fbSel); fb.textContent=`Resultado: ${ok}/${total} (${pct}%).`; fb.style.color=ok===total?'var(--ok)':'var(--bad)';
  }
  function renderMulti(sel, data, fbSel){
    const wrap=$(sel); wrap.innerHTML='';
    data.forEach((it,i)=>{ const lab=document.createElement('label'); lab.className='opt'; lab.innerHTML=`<input type="checkbox" value="${i}"> <span>${it.txt}</span>`; wrap.appendChild(lab); });
    if(fbSel) $(fbSel).textContent='';
  }
  function checkMulti(sel, data, fbSel){
    const chosen=[...$(sel).querySelectorAll('input:checked')].map(i=>Number(i.value)); let ok=0, wrong=0;
    data.forEach((it,i)=>{ const lab=$(sel).querySelector(`input[value="${i}"]`).closest('label'); const correct=(it.ok && chosen.includes(i)) || (!it.ok && !chosen.includes(i)); if(correct){ ok++; lab.classList.add('correct'); } else { wrong++; lab.classList.add('wrong'); } });
    const fb=$(fbSel); fb.textContent=`Correctas: ${ok} · Incorrectas: ${wrong}`; fb.style.color=wrong===0?'var(--ok)':'var(--bad)';
  }
  function resetChecks(sel){ $$(sel+' label').forEach(l=>l.classList.remove('correct','wrong')); $$(sel+' input').forEach(i=>{ i.checked=false; }); }

  /* Datos de juegos */
  const pasosSubida=['Ubicarte de frente al acceso','Verificar peldaños y pasamanos','Establecer tres puntos de apoyo','Cambiar un punto a la vez','Subir un peldaño por vez','Mantener el cuerpo cercano a la estructura','Usar mochila si llevas objetos'];
  const pasosBajada=['De frente al equipo','Mantener tres puntos de apoyo','Bajar un peldaño por vez','Verificar el piso antes de apoyar','En acceso no vertical, bajar de espaldas con pasamanos','No saltar ni correr'];
  const tarjetas3=[
    {txt:'Usar mochila corporativa', tipo:'OK'},{txt:'Saltar el último peldaño', tipo:'BAD'},{txt:'Mantener tres puntos de apoyo', tipo:'OK'},
    {txt:'Inclinar el cuerpo hacia afuera', tipo:'BAD'},{txt:'Revisar barro/aceite', tipo:'OK'},{txt:'Subir o bajar corriendo', tipo:'BAD'},
    {txt:'Bajar de espaldas con pasamanos (no vertical)', tipo:'OK'},{txt:'Deslizarse por pasamanos', tipo:'BAD'}
  ];
  const fillTargets=[
    {slot:'[1]',word:'tres puntos de apoyo'},{slot:'[2]',word:'mochila corporativa'},{slot:'[3]',word:'pasamanos'},
    {slot:'[4]',word:'frente al equipo'},{slot:'[5]',word:'no saltar'}
  ];
  const fillTemplate='Para un acceso seguro, mantén <u data-slot="[1]" class="dropSlot">[1]</u>, usa <u data-slot="[2]" class="dropSlot">[2]</u> para transportar, sujétate a los <u data-slot="[3]" class="dropSlot">[3]</u>, mantente <u data-slot="[4]" class="dropSlot">[4]</u> y recuerda <u data-slot="[5]" class="dropSlot">[5]</u> al llegar al piso.';
  const controls=[
    {txt:'Limpiar barro/aceite antes de usar', zone:'z_resbalon'},{txt:'Tres puntos de apoyo todo el tiempo', zone:'z_equilibrio'},
    {txt:'Mochila para transportar herramientas', zone:'z_objeto'},{txt:'Botas con suela antideslizante', zone:'z_resbalon'},
    {txt:'No inclinar el cuerpo hacia afuera', zone:'z_equilibrio'},{txt:'No llevar objetos en las manos', zone:'z_objeto'}
  ];
  const multi6=[
    {txt:'Dos manos en pasamanos y un pie en peldaño', ok:true},{txt:'Una mano en pasamanos y dos pies firmes', ok:true},
    {txt:'Una mano con celular y otra en pasamanos', ok:false},{txt:'Cambiar puntos de apoyo de a uno', ok:true},
    {txt:'Saltar dos peldaños a la vez', ok:false},{txt:'Bajar de frente sin manos en acceso no vertical', ok:false}
  ];
  const checklist7=[
    {txt:'Peldaños limpios y firmes', ok:true},{txt:'Pasamanos sólido y continuo', ok:true},
    {txt:'Apuro por llegar (correr)', ok:false},{txt:'EPP completo (botas antideslizantes)', ok:true},
    {txt:'Manos ocupadas con objetos sueltos', ok:false},{txt:'Mochila corporativa disponible', ok:true}
  ];
  const pasosCaida=['Detener maniobra y asegurar área','Avisar por radio la emergencia y ubicación','No mover a la persona salvo riesgo mayor','Aplicar primeros auxilios si hay entrenamiento','Esperar asistencia especializada'];
  const buenas=[
    {txt:'Subir con tres puntos de apoyo', ok:true},{txt:'Saltar el último peldaño', ok:false},{txt:'Transportar herramientas en mochila', ok:true},
    {txt:'Correr si llueve para resguardarse', ok:false},{txt:'Revisar pasamanos antes de usar', ok:true},{txt:'Usar ropa suelta', ok:false}
  ];

  // Render inicial
  renderOrder('#ordSubida', pasosSubida, '#fbSubida');
  renderOrder('#ordBajada', pasosBajada, '#fbBajada');
  renderClassify('#pool3','#ok3','#bad3',tarjetas3,'#fb3');
  renderFill('#fillText','#pool4',fillTargets,'#fb4',fillTemplate);
  renderRoles('#pool5',['z_resbalon','z_equilibrio','z_objeto'],controls,'#fb5');
  renderMulti('#multi6',multi6,'#fb6');
  renderMulti('#checklist7',checklist7,'#fb7');
  renderOrder('#ordCaida', pasosCaida, '#fb8');
  renderMulti('#check9', buenas, '#fb9');
  calcProgress(); $('#year').textContent=new Date().getFullYear();

  // Enlaces Juegos
  $('#checkSubida').addEventListener('click', ()=>checkOrder('#ordSubida', pasosSubida, '#fbSubida'));
  $('#mixSubida').addEventListener('click', ()=>renderOrder('#ordSubida', pasosSubida, '#fbSubida'));
  $('#checkBajada').addEventListener('click', ()=>checkOrder('#ordBajada', pasosBajada, '#fbBajada'));
  $('#mixBajada').addEventListener('click', ()=>renderOrder('#ordBajada', pasosBajada, '#fbBajada'));
  $('#check3').addEventListener('click', ()=>checkClassify('#ok3','#bad3',tarjetas3,'#fb3'));
  $('#reset3').addEventListener('click', ()=>renderClassify('#pool3','#ok3','#bad3',tarjetas3,'#fb3'));
  $('#check4').addEventListener('click', ()=>checkFill(fillTargets,'#fb4'));
  $('#reset4').addEventListener('click', ()=>renderFill('#fillText','#pool4',fillTargets,'#fb4',fillTemplate));
  $('#check5').addEventListener('click', ()=>checkRoles(['z_resbalon','z_equilibrio','z_objeto'],controls,'#fb5'));
  $('#reset5').addEventListener('click', ()=>renderRoles('#pool5',['z_resbalon','z_equilibrio','z_objeto'],controls,'#fb5'));
  $('#check6').addEventListener('click', ()=>checkMulti('#multi6',multi6,'#fb6'));
  $('#reset6').addEventListener('click', ()=>{ resetChecks('#multi6'); $('#fb6').textContent=''; });
  $('#check7').addEventListener('click', ()=>checkMulti('#checklist7',checklist7,'#fb7'));
  $('#reset7').addEventListener('click', ()=>{ resetChecks('#checklist7'); $('#fb7').textContent=''; });
  $('#check8').addEventListener('click', ()=>checkOrder('#ordCaida', pasosCaida, '#fb8'));
  $('#mix8').addEventListener('click', ()=>renderOrder('#ordCaida', pasosCaida, '#fb8'));
  $('#check9btn').addEventListener('click', ()=>checkMulti('#check9', buenas, '#fb9'));
  $('#reset9').addEventListener('click', ()=>{ resetChecks('#check9'); $('#fb9').textContent=''; });

  // Timed
  const timed=[
    {q:'Ves barro en peldaños al subir', opts:['Subir con cuidado','Detener, limpiar/reportar y bloquear acceso','Dar un salto para pasar rápido'], ok:1},
    {q:'Debes subir herramientas y ambos pasamanos son necesarios', opts:['Llevarlas en la mano','Usar mochila corporativa','Pedir que te las lancen'], ok:1},
    {q:'Acceso no vertical con pasamanos', opts:['Bajar de frente sin manos','Bajar de espaldas usando pasamanos','Saltar de dos en dos'], ok:1},
    {q:'Vas apurado por cambio de turno', opts:['Correr por el acceso','Mantener ritmo normal y seguro','Saltar el último peldaño'], ok:1},
    {q:'Peldaño suelto detectado', opts:['Seguir y avisar después','Reportar y bloquear acceso','Ignorar si parece firme'], ok:1}
  ];
  let tIndex=0,tScore=0,remaining=10,tId=null;
  function startTimer(){ remaining=10; $('#timer').textContent='Tiempo: '+remaining; clearInterval(tId); tId=setInterval(()=>{ remaining--; $('#timer').textContent='Tiempo: '+remaining; if(remaining<=0){ clearInterval(tId); lockTimed(false); } },1000); }
  function renderTimed(){ const t=timed[tIndex]; $('#timedQ').innerHTML='<strong>Escenario '+(tIndex+1)+'</strong>: '+t.q; const w=$('#timedOpts'); w.innerHTML=''; t.opts.forEach((txt,i)=>{ const b=document.createElement('button'); b.className='btn-ghost'; b.textContent=txt; b.addEventListener('click', ()=>lockTimed(i===t.ok)); w.appendChild(b); }); $('#fb10').textContent=''; startTimer(); }
  function lockTimed(correct){ clearInterval(tId); const t=timed[tIndex]; $$('#timedOpts button').forEach((b,i)=>{ b.disabled=true; if(i===t.ok) b.classList.add('btn-sec'); if(correct && i===t.ok) b.style.outline='2px solid var(--ok)'; }); if(correct){ tScore++; $('#fb10').textContent='¡Correcto!'; $('#fb10').style.color='var(--ok)'; } else { $('#fb10').textContent='Incorrecto o fuera de tiempo.'; $('#fb10').style.color='var(--bad)'; } }
  function resetTimed(){ clearInterval(tId); tIndex=0; tScore=0; renderTimed(); }
  $('#nextTimed').addEventListener('click', ()=>{ if(tIndex<timed.length-1){ tIndex++; renderTimed(); } else { $('#fb10').textContent=`Puntaje final: ${tScore}/${timed.length}.`; $('#fb10').style.color=tScore===timed.length?'var(--ok)':'var(--bad)'; }});
  $('#resetTimed').addEventListener('click', resetTimed);
  renderTimed();

  // Quiz 20
  const preguntas=[
    {q:'Usar accesos diseñados para subir/bajar es…', opts:['Opcional','Obligatorio','Solo de noche'], ok:1},
    {q:'Tres puntos de apoyo significa…', opts:['Una mano libre','Dos manos y un pie, o dos pies y una mano','Solo dos pies'], ok:1},
    {q:'Antes de subir debes revisar…', opts:['Solo si llueve','Peldaños, pasamanos, barro/aceite','Nada, sube y mira después'], ok:1},
    {q:'La mochila corporativa se usa para…', opts:['Llevar objetos sin ocupar manos','Decoración','Evitar casco'], ok:0},
    {q:'Bajar al piso se debe…', opts:['Saltar para ahorrar tiempo','Apoyar con precaución, sin saltar','De espaldas siempre'], ok:1},
    {q:'En accesos no verticales corresponde…', opts:['Bajar de espaldas usando pasamanos','Bajar corriendo','No usar manos'], ok:0},
    {q:'Está prohibido…', opts:['Inclinar el cuerpo hacia afuera','Revisar pasamanos','Limpiar peldaños'], ok:0},
    {q:'El EPP clave para adherencia es…', opts:['Botas antideslizantes','Zapatos de calle','Sandalias'], ok:0},
    {q:'Si detectas peldaño suelto…', opts:['Reportas y bloqueas acceso','Lo ignoras','Subes con cuidado nomás'], ok:0},
    {q:'Al transportar objetos…', opts:['Mochila corporativa','En las manos','En el bolsillo'], ok:0},
    {q:'Al bajar, la postura correcta es…', opts:['De frente al equipo','De lado','Sin mirar'], ok:0},
    {q:'Correr por el acceso…', opts:['Reduce riesgo','Aumenta riesgo','Es neutro'], ok:1},
    {q:'Si hay aceite en peldaños…', opts:['Subes rápido','Detienes, limpias o reportas','No importa'], ok:1},
    {q:'Tres puntos de apoyo se mantienen…', opts:['Solo al inicio','Todo el tiempo','Solo al final'], ok:1},
    {q:'Pasamanos en mal estado…', opts:['Se informa y no se usa','Se usa igual','Se decora'], ok:0},
    {q:'Ropa suelta…', opts:['Puede engancharse, evitar','Da estilo','Es obligatoria'], ok:0},
    {q:'Bajar saltando…', opts:['Evitar, riesgo de lesiones','Recomendado','Obligatorio'], ok:0},
    {q:'Guantes con buen agarre…', opts:['Mejoran adherencia','Empeoran adherencia','Sin efecto'], ok:0},
    {q:'Con prisa por turno…', opts:['Correr','Mantener ritmo seguro','Saltar peldaños'], ok:1},
    {q:'Tras la maniobra, comunicar anomalías…', opts:['Es buena práctica','No corresponde','Solo si hay testigos'], ok:0}
  ];
  function renderQuiz(){ const wrap=$('#quiz'); wrap.innerHTML=''; preguntas.forEach((p,i)=>{ const div=document.createElement('div'); div.className='q'; div.dataset.ok=p.ok; div.innerHTML=`<div style="font-weight:700">${i+1}. ${p.q}</div>` + p.opts.map((txt,j)=>`<label class="opt"><input type="radio" name="q${i}" value="${j}"> <span>${txt}</span></label>`).join(''); wrap.appendChild(div); }); }
  function lockQuiz(){ const blocks=$$('#quiz .q'); let okC=0, wrongC=0, noAns=0; blocks.forEach(div=>{ const ok=Number(div.dataset.ok); const sel=div.querySelector('input[type="radio"]:checked'); div.querySelectorAll('input').forEach(inp=> inp.disabled=true); const corr=div.querySelector(`input[value="${ok}"]`)?.closest('label'); corr?.classList.add('correct'); if(!sel){ div.classList.add('wrong'); noAns++; wrongC++; return; } const chosen=Number(sel.value); if(chosen===ok){ div.classList.add('correct'); okC++; } else { div.classList.add('wrong'); sel.closest('label')?.classList.add('wrong'); wrongC++; } }); const pct=Math.round(okC/preguntas.length*100); $('#quizFeedback').textContent=`Resultado: ${okC}/${preguntas.length} (${pct}%). ${noAns?noAns+' sin responder.':''}`; $('#quizFeedback').style.color=okC===preguntas.length?'var(--ok)':'var(--bad)'; }
  function resetQuiz(){ $$('#quiz .q').forEach(div=>{ div.classList.remove('correct','wrong'); div.querySelectorAll('label').forEach(l=> l.classList.remove('correct','wrong')); div.querySelectorAll('input').forEach(inp=>{ inp.disabled=false; inp.checked=false; }); }); $('#quizFeedback').textContent=''; }
  renderQuiz();
  $('#enviar').addEventListener('click', lockQuiz);
  $('#resetQuiz').addEventListener('click', resetQuiz);

  // Reflexión
  const ref=$('#reflexion'); ref.value=state.reflexion||'';
  $('#guardarRef').addEventListener('click', ()=>{ state.reflexion=(ref.value||'').trim(); store('anupro360_syb',state); alert('Reflexión guardada.'); });
  $('#copiarRef').addEventListener('click', async()=>{ try{ await navigator.clipboard.writeText((ref.value||'').trim()); alert('Texto copiado.'); }catch(e){ alert('Copia manual necesaria.'); } });

  // Init UI
  calcProgress(); $('#year').textContent=new Date().getFullYear();
</script>
</body>
</html>
